

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Set space between paragraphs -----------------------------------------------------
\newlength{\defaultparskip}% Save parskip
\newlength{\defaultparindent}% Save parindent
\setlength{\defaultparskip}{\parskip}% save the value
\setlength{\defaultparindent}{\parindent}% save the value

%\newcommand{\defaultparskip}{1em}
%\newcommand{\defaultparindent}{3em}
%\setlength{\parskip}{\defaultparskip}
%\setlength{\parindent}{\defaultparindent}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Chapter title formatting ----------------------------------------------
%\titleformat
%{\chapter} % command
%[block] % shape
%%{\huge\bfseries} % format
%{\huge\ttseries\filcenter\textsc}%format
%{\thechapter.} % label
%{1ex} % sep
%{
%%    \rule{\textwidth}{1pt}
%%	\null
%%    \vspace{1em}
%    \textsc
%%    \centering
%} % before-code
%[
%%\vspace{-0.5ex}%
%%\rule{\textwidth}{0.3pt}
%] % after-code
\titleformat{\chapter}[display]
{\bfseries\Large}
{ %\Huge\textsc{\chaptertitlename}
\hfill\fontsize{120}{70}\selectfont\color{lightgray}\textbf{\thechapter}}
{-2ex}
{\filleft\fontsize{50}{70}\selectfont\scshape}
[\vspace{0ex}]

\titlespacing*{\chapter}{0pt}{50pt}{40pt}

% Section title formatting ----------------------------------------------
\titleformat{\section}[block]
{\Large\bfseries}
{\thesection.}{0.5em}{\textsc}

% Subsection title formatting -------------------------------------------
\titleformat{\subsection}[block]
{\large\bfseries}
{\thesubsection.}{0.5em}{\textsc}

% Subsection title formatting -------------------------------------------
\titleformat{\subsubsection}[block]
{\normalsize\bfseries}
{\thesubsubsection.}{0.5em}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Define dots in TOC ----------------------------------------------------------
\renewcommand{\cftpartleader}{\cftdotfill{\cftdotsep}} % for parts
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}} % for chapters
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Depth of section numbering ----------------------
\setcounter{secnumdepth}{4}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Format of tables -----------------------------------------------------------------
\setlength\cftbeforechapskip{20pt}
\renewcommand\cftfigafterpnum{\vskip5pt\par}
\renewcommand\cfttabafterpnum{\vskip5pt\par}
\setlength{\cftfignumwidth}{4em}  % Modify number width in LoF
\setlength{\cfttabnumwidth}{4em}
\setlength{\cftchapnumwidth}{2em}
\setlength{\cftsecnumwidth}{3em}
\setlength{\cftsubsecnumwidth}{4em}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Glossary

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% One page
\newcommand{\addstretch}[1]{\addtolength{#1}{\fill}}
\newenvironment{onepage}
  {\newpage\flushbottom
   \addstretch{\baselineskip}
   \addstretch{\abovedisplayskip}
   \addstretch{\abovedisplayshortskip}
   \addstretch{\belowdisplayskip}
   \addstretch{\belowdisplayshortskip}
   \setlength{\parskip}{0pt}}
  {\newpage}



\newlength{\currentparskip}% Save parskip
\newlength{\currentparindent}% Save parindent
\newenvironment{smini}%
{%
\setlength{\currentparskip}{\parskip}% save the value
\setlength{\currentparindent}{\parindent}% save the value
\noindent\begin{minipage}[c][\textheight][s]{\linewidth}%
\baselineskip=1\baselineskip plus 1fill% stretch as much as needed
\lineskip=0pt plus 1fill% just for safety
\setlength{\parskip}{\currentparskip}%
%\setlength{\parindent}{\currentparindent}%
}% restore the value
{\end{minipage}}%

\newenvironment{mini}%
{%
\setlength{\currentparskip}{\parskip}% save the value
\setlength{\currentparindent}{\parindent}% save the value
\begin{minipage}[s][\textheight]{\linewidth}%
\baselineskip=1\baselineskip plus 1fill% stretch as much as needed
\lineskip=0pt plus 1fill% just for safety
\setlength{\parskip}{\currentparskip}%
%\setlength{\parindent}{\currentparindent}%
}% restore the value
{\end{minipage}}%

\newenvironment{imini}%
{%
\setlength{\currentparskip}{\parskip}% save the value
\setlength{\currentparindent}{\parindent}% save the value
\noindent%
\begin{minipage}[s][\textheight]{\linewidth}%
\baselineskip=1\baselineskip plus 1fill% stretch as much as needed
\lineskip=0pt plus 1fill% just for safety
\setlength{\parskip}{\currentparskip}%
\setlength{\parindent}{\currentparindent}%
}% restore the value
{\end{minipage}}%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Invisible section
\newcommand\invisiblesection[1]{%
    \refstepcounter{section}%
    \phantomsection%
    \addcontentsline{toc}{section}{\protect\numberline{\thesection}#1}%
    \sectionmark{#1}%
    \markboth{\textsc{{\Large #1}}}{}
}

% Invisible unnumbered section
\newcommand\invisibleunnumberedsection[1]{%
    %\addcontentsline{toc}{section}{\protect{\thesection}#1}%
    \phantomsection%
    \addcontentsline{toc}{section}{\protect\numberline{}#1}
    \sectionmark{#1}%
    \markboth{\textsc{{\Large #1}}}{}
}
\newcommand\invisiblechapter[1]{%
    \refstepcounter{chapter}%
    \phantomsection%
    \addcontentsline{toc}{chapter}{\protect\numberline{\thechapter}#1}%
    \chaptermark{#1}%
    \markboth{\textsc{{\Large #1}}}{}
}

% Invisible unnumbered chapter
\newcommand\invisibleunnumberedchapter[1]{%
    %\addcontentsline{toc}{section}{\protect{\thesection}#1}%
    \phantomsection%
    \addcontentsline{toc}{chapter}{\protect\numberline{}#1}
    \chaptermark{#1}%
    \markboth{\textsc{{\Large #1}}}{}
}

